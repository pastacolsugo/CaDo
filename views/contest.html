<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1"><!--Added the viewport meta tag to view the site properly on mobile-->
    <title>Contest Setup</title>
    <script type="text/javascript">
    function padding(n){
        return (n<10?'0':'')+n.toString();
    }
    function timeDelta(end){
        var now=new Date();
        var res=now.getTime()<end.getTime()?"-":"";
        var delta=new Date(end.getTime()-now.getTime());
        res+=delta.getUTCHours().toString()+':'+padding(delta.getMinutes())+':'+padding(delta.getSeconds());
        return res;
    }
    function getUrlPromise(url) {
        return new Promise(function(resolve,reject){
        var webrequest = new XMLHttpRequest();
        webrequest.open('GET', url, true);
        webrequest.onload=function(){
            resolve(webrequest.responseText);
        };
        webrequest.send(null);});
    }
    function scoreToClassName(score){
        var res="Score"
        res=(score<20? "low":(score==100?"full":"medium"))+res;
        return res;
    }
    </script>
    <link rel="stylesheet" href="/stylesheets/master.css">
    <link rel="stylesheet" href="/stylesheets/contest.css">
</head>

<body class="container">
    <div class="header">
        <h1>CaDo Contest Setup Page</h1>
        <img class="userImg" alt=":)" src="/utility/profilePic">
        <div class="userName">pastacolsugo</div>
    </div>

    <div class="sidebar" id="sidebar">
        <div class="timer">
            <p id="timer"></p>
        </div>
    </div>

    <div class="content"> <h2 class="problemTitle">Taxi</h2>
        <div class="lipsum"></div>
    </div>
    <script type="text/javascript">
        getUrlPromise("/api/contest").then(function(response){
            var contest=JSON.parse(response);
            var endDate=new Date(contest.end_date);
            setInterval(function(){
                document.getElementById("timer").innerHTML=timeDelta(endDate);
            }, 1000);
            var sidebar=document.getElementById("sidebar");
            for(var i=0;i<contest.tasks.length; i++){
                var problemBox=document.createElement("div");
                problemBox.id=contest.tasks[i].name;
                problemBox.classList.add("problemBox");
                problemBox.classList.add(scoreToClassName(contest.tasks[i].score));
                var title=document.createElement("div");
                title.classList.add("problemTitle");
                title.innerHTML=contest.tasks[i].full_name;
                problemBox.appendChild(title);
                var score=document.createElement("div");
                score.classList.add("score");
                score.innerHTML=contest.tasks[i].score;
                problemBox.appendChild(score);
                var statement=document.createElement("a");
                statement.classList.add("link");
                statement.classList.add("statementLink");
                statement.innerHTML="Testo";
                statement.href="/api/task?task="+encodeURIComponent(contest.tasks[i].name);
                problemBox.appendChild(statement);
                var submissions=document.createElement("a");
                submissions.classList.add("link");
                submissions.classList.add("submissionLink");
                submissions.innerHTML="Sottoposizioni";
                problemBox.appendChild(submissions);
                sidebar.appendChild(problemBox);
                var alert=document.createElement("div");
                alert.classList.add("alert-icon");
                problemBox.appendChild(alert);
            }
            getUrlPromise('/api/alerts').then(function(res){
                var alerts=JSON.parse(res);
                for(var i=0;i<alerts.length;i++){
                    document.getElementById(alerts[i]).classList.add("alert");
                }
            });
        });
    </script>
    <script src="/utility/lipsum.js" type="text/javascript"></script><!--This is because I was tired of looking at a really long HTML and because it's now really easy to put some filler text (just include the script and an element with class="lipsum" and you're done)-->
</body>
</html>